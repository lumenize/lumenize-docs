---
title: Client-Side Usage
description: How to interact with Lumenize from client applications
sidebar:
  order: 2
---

# Client-Side Usage

Learn how to connect to and interact with your Lumenize backend from client applications.

## LumenizeClient

The generic client works in any JavaScript/TypeScript environment.

### Basic Setup

```typescript
import { LumenizeClient } from "lumenize";

const client = new LumenizeClient({
  agent: "mylumenizeserver",  // Your server class name in kebab-case
  name: "instance-name",      // Specific Durable Object instance
  host: window.location.host, // Or your server host
  timeout: 5000,              // Request timeout in ms (default: 5000)
  route: "jsonrpc"            // Endpoint route (default: 'jsonrpc')
});
```

### Making Method Calls

The client provides multiple ways to call your server methods:

```typescript
// Generic call method
const result = await client.call("subtract", [42, 23]);

// Direct method calls (auto-generated based on your server methods)
const result = await client.subtract(42, 23);

// Named parameters
const result = await client.subtract({ minuend: 42, subtrahend: 23 });

// Mixed parameter order (named params)
const result = await client.subtract({ subtrahend: 23, minuend: 42 });

console.log(result); // 19
```

## HTTP Requests (Manual)

For environments where you can't use the client library:

### Single Request

```typescript
const response = await fetch("https://your-worker.your-subdomain.workers.dev/agents/mylumenizeserver/instance-name/jsonrpc", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    jsonrpc: "2.0",
    method: "subtract",
    params: [42, 23],
    id: 1
  })
});

const result = await response.json();
console.log(result); // { jsonrpc: '2.0', result: 19, id: 1 }
```

### Batch Requests

JSON-RPC 2.0 supports batch operations:

```typescript
const response = await fetch("https://your-worker.your-subdomain.workers.dev/agents/mylumenizeserver/instance-name/jsonrpc", {
  method: "POST", 
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify([
    { jsonrpc: "2.0", method: "subtract", params: [42, 23], id: 1 },
    { jsonrpc: "2.0", method: "subtract", params: [23, 42], id: 2 },
    { jsonrpc: "2.0", method: "getUserProfile", params: ["user123"], id: 3 }
  ])
});

const results = await response.json();
// Array of responses with matching IDs
```

## WebSocket Connections

### Using LumenizeClient

```typescript
const client = new LumenizeClient({
  agent: "mylumenizeserver",
  name: "instance-name", 
  host: "your-worker.your-subdomain.workers.dev",
  transport: "websocket"  // Use WebSocket instead of HTTP
});

// Same API as HTTP client
const result = await client.subtract(42, 23);

// Subscribe to real-time updates
await client.subscribe("team-updates", (data) => {
  console.log("Team updated:", data);
});
```

### Manual WebSocket

```typescript
const ws = new WebSocket("wss://your-worker.your-subdomain.workers.dev/agents/mylumenizeserver/instance-name");

ws.onopen = () => {
  // Send JSON-RPC request wrapped in envelope
  ws.send(JSON.stringify({
    type: "jsonrpc",
    payload: {
      jsonrpc: "2.0",
      method: "subtract", 
      params: [42, 23],
      id: 1
    }
  }));
};

ws.onmessage = (event) => {
  const envelope = JSON.parse(event.data);
  if (envelope.type === "jsonrpc") {
    console.log("Response:", envelope.payload);
  }
};
```

## Reactive Clients

### Svelte Integration

```svelte
<script>
  import { useLumenize } from "lumenize/svelte";
  
  const { data, loading, error, call } = useLumenize({
    agent: "mylumenizeserver",
    name: "instance-name",
    host: "your-worker.your-subdomain.workers.dev"
  });
  
  async function handleCalculation() {
    const result = await call("subtract", [42, 23]);
    console.log("Result:", result);
  }
</script>

{#if loading}
  <p>Connecting...</p>
{:else if error}
  <p>Error: {error.message}</p>
{:else}
  <button on:click={handleCalculation}>Calculate</button>
  
  <!-- Reactive data updates automatically -->
  {#if $data.teamMetrics}
    <div>Team Score: {$data.teamMetrics.score}</div>
  {/if}
{/if}
```

### React Integration (Coming Soon)

```jsx
import { useLumenize } from "lumenize/react";

function MyComponent() {
  const { data, loading, error, call } = useLumenize({
    agent: "mylumenizeserver", 
    name: "instance-name",
    host: "your-worker.your-subdomain.workers.dev"
  });
  
  const handleCalculation = async () => {
    const result = await call("subtract", [42, 23]);
    console.log("Result:", result);
  };
  
  if (loading) return <div>Connecting...</div>;
  if (error) return <div>Error: {error.message}</div>;
  
  return (
    <div>
      <button onClick={handleCalculation}>Calculate</button>
      {data.teamMetrics && (
        <div>Team Score: {data.teamMetrics.score}</div>
      )}
    </div>
  );
}
```

## Error Handling

```typescript
try {
  const result = await client.subtract("invalid", "params");
} catch (error) {
  if (error.code === -32602) {
    console.log("Invalid method parameters");
  } else if (error.code === -32601) {
    console.log("Method not found");
  } else {
    console.log("Other error:", error.message);
  }
}
```

## Advanced Features

### Shared Worker (Browser)

The reactive clients automatically use SharedWorker for WebSocket multiplexing across browser tabs:

```typescript
// Automatically shared across all tabs on the same origin
const client = new LumenizeClient({
  agent: "mylumenizeserver",
  name: "instance-name",
  useSharedWorker: true  // Default in browser environments
});
```

### Custom Storage Reactivity

Build your own reactive layer using the storage-based core:

```typescript
import { LumenizeStorage } from "lumenize/storage";

const storage = new LumenizeStorage("mylumenizeserver");

// Listen for changes
storage.addEventListener("change", (event) => {
  console.log("Data updated:", event.detail);
  // Update your UI framework's reactive state
});

// Trigger updates
await storage.set("teamMetrics", { score: 95 });
```

## Next Steps

- [Real-time Features](/docs/features/realtime) - Learn about subscriptions and live updates
- [Entity Operations](/docs/usage/entities) - Work with data entities
- [MCP Integration](/docs/features/mcp) - Use Model Context Protocol features
